<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zuora Order-to-Cash Flow</title>
    <style>
        :root {
            --zuora-blue: #0033a0;
            --bg-light: #f8f9fa;
            --border-color: #dee2e6;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: #fff;
        }

        h1 {
            text-align: center;
            color: var(--zuora-blue);
            border-bottom: 3px solid var(--zuora-blue);
            padding-bottom: 20px;
            margin-bottom: 10px;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }

        nav.toc {
            background: var(--bg-light);
            padding: 20px 30px;
            border-radius: 8px;
            margin-bottom: 30px;
        }

        .toc h3 {
            margin-top: 0;
            color: var(--zuora-blue);
        }

        .toc ul {
            display: flex;
            flex-wrap: wrap;
            gap: 10px 30px;
            list-style-type: none;
            padding-left: 0;
            margin: 0;
        }

        .toc a {
            color: var(--zuora-blue);
            text-decoration: none;
            font-weight: 500;
        }

        .toc a:hover {
            text-decoration: underline;
        }

        .diagram-section {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 25px;
            margin: 30px 0;
            box-shadow: 0 2px 12px rgba(0,0,0,0.05);
        }

        .diagram-section h2 {
            color: var(--zuora-blue);
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 10px;
            margin-top: 0;
        }

        .diagram-section .description {
            color: #666;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .diagram-container {
            text-align: center;
            background: var(--bg-light);
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
        }

        .diagram-container img {
            max-width: 100%;
            height: auto;
            border-radius: 4px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .info-box {
            background: var(--bg-light);
            border-radius: 8px;
            padding: 15px 20px;
            border-left: 4px solid var(--zuora-blue);
        }

        .info-box h4 {
            margin: 0 0 10px 0;
            color: var(--zuora-blue);
        }

        .info-box ul {
            margin: 0;
            padding-left: 20px;
        }

        .info-box li {
            margin: 5px 0;
            font-size: 14px;
        }

        .transition-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 15px;
            padding: 15px;
            background: var(--bg-light);
            border-radius: 8px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .legend-line {
            width: 40px;
            height: 3px;
        }

        .legend-line.solid {
            background: #666;
        }

        .legend-line.dashed {
            background: repeating-linear-gradient(
                90deg,
                #666 0px,
                #666 8px,
                transparent 8px,
                transparent 12px
            );
        }

        .state-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin: 2px;
        }

        .state-initial { background: #fff2cc; color: #9a6700; border: 1px solid #d6b656; }
        .state-pending { background: #e1d5e7; color: #5c4a6e; border: 1px solid #9673a6; }
        .state-active { background: #d5e8d4; color: #2d6a2d; border: 1px solid #82b366; }
        .state-warning { background: #ffe6cc; color: #8a5a00; border: 1px solid #d79b00; }
        .state-terminal { background: #f8cecc; color: #8b2c2c; border: 1px solid #b85450; }
        .state-process { background: #dae8fc; color: #3a5a8a; border: 1px solid #6c8ebf; }

        footer {
            text-align: center;
            margin-top: 50px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
            color: #6c757d;
            font-size: 14px;
        }

        @media print {
            .diagram-section {
                page-break-inside: avoid;
            }
        }

        /* Navigation Bar */
        .nav-bar {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 12px 20px;
            background: #2c3e50;
            border-radius: 8px;
            margin-bottom: 30px;
        }

        .nav-bar a {
            color: #fff;
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            padding: 6px 12px;
            border-radius: 4px;
            transition: background 0.2s;
        }

        .nav-bar a:hover {
            background: rgba(255,255,255,0.15);
        }

        .nav-bar a.active {
            background: rgba(255,255,255,0.2);
        }

        .nav-home {
            display: flex;
            align-items: center;
            gap: 6px;
            padding-right: 20px;
            border-right: 1px solid rgba(255,255,255,0.3);
        }

        .nav-home svg {
            width: 18px;
            height: 18px;
            fill: currentColor;
        }

        .nav-dropdown {
            position: relative;
            padding: 6px 12px;
            border-radius: 4px;
            color: #fff;
            font-size: 14px;
            font-weight: 500;
        }

        .nav-dropdown:hover {
            background: rgba(255,255,255,0.15);
        }

        .nav-dropdown.active {
            background: rgba(255,255,255,0.2);
        }

        .nav-dropdown-toggle {
            display: flex;
            align-items: center;
            gap: 4px;
            cursor: pointer;
        }

        .nav-dropdown-toggle::after {
            content: "";
            border-left: 4px solid transparent;
            border-right: 4px solid transparent;
            border-top: 5px solid currentColor;
            margin-left: 2px;
        }

        .nav-dropdown-menu {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            background: #2c3e50;
            border-radius: 6px;
            padding: 8px 0;
            min-width: 160px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 100;
        }

        .nav-dropdown:hover .nav-dropdown-menu {
            display: block;
        }

        .nav-dropdown-menu a {
            display: block;
            padding: 8px 16px;
            border-radius: 0;
        }

        .nav-dropdown-menu a:hover {
            background: rgba(255,255,255,0.15);
        }

        .nav-dropdown-menu a.active {
            background: rgba(255,255,255,0.1);
        }
    </style>
</head>
<body>
    <nav class="nav-bar">
        <a href="../index.html" class="nav-home">
            <svg viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
            Home
        </a>
        <a href="../api-comparisons.html">API Comparisons</a>
        <div class="nav-dropdown active">
            <span class="nav-dropdown-toggle">Zuora</span>
            <div class="nav-dropdown-menu">
                <a href="order-to-cash-flow.html" class="active">OTC Flow</a>
                <a href="entity-state-machines.html">State Machines</a>
            </div>
        </div>
        <div class="nav-dropdown">
            <span class="nav-dropdown-toggle">Stripe</span>
            <div class="nav-dropdown-menu">
                <a href="../stripe/entity-state-machines.html">State Machines</a>
            </div>
        </div>
        <div class="nav-dropdown">
            <span class="nav-dropdown-toggle">Maxio</span>
            <div class="nav-dropdown-menu">
                <a href="../maxio/entity-state-machines.html">State Machines</a>
            </div>
        </div>
    </nav>

    <h1>Zuora Order-to-Cash Flow</h1>
    <p class="subtitle">End-to-end billing process from customer acquisition to payment collection</p>

    <nav class="toc">
        <h3>Quick Navigation</h3>
        <ul>
            <li><a href="#otc-process">OTC Process Flow</a></li>
            <li><a href="#customer-lifecycle">Customer Lifecycle</a></li>
            <li><a href="#entities">Entity Reference</a></li>
        </ul>
    </nav>

    <!-- OTC Process Flow -->
    <section class="diagram-section" id="otc-process">
        <h2>Order-to-Cash Process Flow</h2>
        <p class="description">
            The Order-to-Cash (OTC) process represents the complete billing lifecycle in Zuora,
            from customer account creation through payment collection. Each entity builds on the previous,
            with specific triggers and dependencies at each stage.
        </p>
        <div class="diagram-container">
            <img src="otc-process-flow.png" alt="Zuora Order-to-Cash Process Flow">
        </div>

        <div class="info-grid">
            <div class="info-box">
                <h4>Entity Chain</h4>
                <ul>
                    <li><strong>Account</strong> - Billable customer entity with contacts and payment methods</li>
                    <li><strong>Subscription</strong> - Recurring billing relationship with rate plans</li>
                    <li><strong>Invoice</strong> - Billing document with charges, taxes, and due dates</li>
                    <li><strong>Payment</strong> - Transaction against gateway for settlement</li>
                </ul>
            </div>
            <div class="info-box">
                <h4>Key Dependencies</h4>
                <ul>
                    <li>Subscription requires an <em>Active</em> Account</li>
                    <li>Invoice requires an <em>Active</em> Subscription</li>
                    <li>Payment requires a <em>Posted</em> Invoice</li>
                    <li>Amendment requires an existing Subscription</li>
                </ul>
            </div>
        </div>
    </section>

    <!-- Customer Lifecycle -->
    <section class="diagram-section" id="customer-lifecycle">
        <h2>Customer Lifecycle with Dunning</h2>
        <p class="description">
            The customer lifecycle tracks the journey from prospect through active customer to potential churn.
            This includes the dunning process for handling failed payments and automated system behaviors.
        </p>
        <div class="diagram-container">
            <img src="customer-lifecycle.png" alt="Zuora Customer Lifecycle with Dunning">
        </div>

        <div class="transition-legend">
            <div class="legend-item">
                <div class="legend-line solid"></div>
                <span>Manual / API-triggered transition</span>
            </div>
            <div class="legend-item">
                <div class="legend-line dashed"></div>
                <span>Automated / System-triggered transition</span>
            </div>
        </div>

        <div class="info-grid">
            <div class="info-box">
                <h4>Customer States</h4>
                <ul>
                    <li><span class="state-badge state-initial">Prospect</span> Lead in CRM, not yet in Zuora</li>
                    <li><span class="state-badge state-pending">Onboarding</span> Account created, configuring</li>
                    <li><span class="state-badge state-active">Active</span> Subscription active, billing normally</li>
                    <li><span class="state-badge state-warning">Delinquent</span> Payment failed, dunning in progress</li>
                    <li><span class="state-badge state-terminal">Suspended</span> Services suspended after dunning exhausted</li>
                    <li><span class="state-badge state-terminal">Churned</span> Customer cancelled or terminated</li>
                </ul>
            </div>
            <div class="info-box">
                <h4>Dunning Process</h4>
                <ul>
                    <li><strong>Trigger:</strong> Payment fails at gateway</li>
                    <li><strong>Retry 1:</strong> Wait configured days, retry payment</li>
                    <li><strong>Retry 2:</strong> Send reminder email, retry again</li>
                    <li><strong>Retry 3:</strong> Final attempt with escalation notice</li>
                    <li><strong>Exhausted:</strong> Suspend services or cancel subscription</li>
                    <li><strong>Recovery:</strong> Successful payment returns to Active</li>
                </ul>
            </div>
            <div class="info-box">
                <h4>Automated Transitions</h4>
                <ul>
                    <li>Bill run generates invoices automatically</li>
                    <li>Auto-pay triggers payment collection</li>
                    <li>Dunning retries happen on schedule</li>
                    <li>Auto-renewal extends subscription terms</li>
                    <li>Subscription expiry on term end (if no renewal)</li>
                </ul>
            </div>
            <div class="info-box">
                <h4>Manual Transitions</h4>
                <ul>
                    <li>POST /accounts - Create customer account</li>
                    <li>POST /subscriptions - Create subscription</li>
                    <li>Orders API - Create amendments</li>
                    <li>POST /payments - Manual payment collection</li>
                    <li>Customer cancellation request</li>
                </ul>
            </div>
        </div>
    </section>

    <!-- Entity Reference -->
    <section class="diagram-section" id="entities">
        <h2>Entity Quick Reference</h2>
        <p class="description">
            Summary of key Zuora entities involved in the Order-to-Cash process.
        </p>

        <div class="info-grid">
            <div class="info-box">
                <h4>Account</h4>
                <ul>
                    <li>Represents the billable customer</li>
                    <li>Contains BillTo and SoldTo contacts</li>
                    <li>Stores payment methods</li>
                    <li>Holds billing and payment settings</li>
                    <li>States: Draft, Active, Canceled</li>
                </ul>
            </div>
            <div class="info-box">
                <h4>Subscription</h4>
                <ul>
                    <li>Links account to rate plans (products)</li>
                    <li>Defines billing frequency and terms</li>
                    <li>Supports amendments for changes</li>
                    <li>Can be suspended and resumed</li>
                    <li>States: Draft, Pending, Active, Suspended, Cancelled</li>
                </ul>
            </div>
            <div class="info-box">
                <h4>Invoice</h4>
                <ul>
                    <li>Generated by bill runs or API</li>
                    <li>Contains line items with charges</li>
                    <li>Tracks balance and due date</li>
                    <li>Can apply credit memos</li>
                    <li>States: Draft, Posted, Canceled, Error</li>
                </ul>
            </div>
            <div class="info-box">
                <h4>Payment</h4>
                <ul>
                    <li>Processes through payment gateway</li>
                    <li>Applied to one or more invoices</li>
                    <li>Supports refunds</li>
                    <li>Tracks settlement status separately</li>
                    <li>States: Draft, Processing, Processed, Posted, Error, Canceled</li>
                </ul>
            </div>
            <div class="info-box">
                <h4>Amendment</h4>
                <ul>
                    <li>Modifies existing subscriptions</li>
                    <li>Created via Orders API</li>
                    <li>May generate proration invoices</li>
                    <li>Types: NewProduct, RemoveProduct, UpdateProduct, ChangePlan, Cancellation, Renewal, TermsAndConditions, OwnerTransfer</li>
                </ul>
            </div>
            <div class="info-box">
                <h4>Order</h4>
                <ul>
                    <li>Container for subscription changes</li>
                    <li>Supports scheduled execution</li>
                    <li>Can be reverted (with feature flag)</li>
                    <li>Most complex entity lifecycle</li>
                    <li>States: Draft, Pending, Scheduled, Executing, Completed, Reverted, Cancelled, Failed</li>
                </ul>
            </div>
        </div>
    </section>

    <footer>
        <p>Zuora Order-to-Cash Flow - Sinch Payment Services</p>
        <p>See also: <a href="entity-state-machines.html">Entity State Machines</a></p>
        <p>Source: <a href="https://developer.zuora.com">Zuora API Documentation</a></p>
        <p>Last updated: December 2024</p>
    </footer>
</body>
</html>
