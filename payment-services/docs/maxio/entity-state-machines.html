<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maxio Entity State Machines</title>
    <style>
        :root {
            --maxio-green: #00a878;
            --bg-light: #f8f9fa;
            --border-color: #dee2e6;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: #fff;
        }

        h1 {
            text-align: center;
            color: var(--maxio-green);
            border-bottom: 3px solid var(--maxio-green);
            padding-bottom: 20px;
            margin-bottom: 10px;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }

        nav.toc {
            background: var(--bg-light);
            padding: 20px 30px;
            border-radius: 8px;
            margin-bottom: 30px;
        }

        .toc h3 {
            margin-top: 0;
            color: var(--maxio-green);
        }

        .toc ul {
            display: flex;
            flex-wrap: wrap;
            gap: 10px 30px;
            list-style-type: none;
            padding-left: 0;
            margin: 0;
        }

        .toc a {
            color: var(--maxio-green);
            text-decoration: none;
            font-weight: 500;
        }

        .toc a:hover {
            text-decoration: underline;
        }

        .diagram-section {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 25px;
            margin: 30px 0;
            box-shadow: 0 2px 12px rgba(0,0,0,0.05);
        }

        .diagram-section h2 {
            color: var(--maxio-green);
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 10px;
            margin-top: 0;
        }

        .diagram-section .description {
            color: #666;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .diagram-container {
            text-align: center;
            background: var(--bg-light);
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
        }

        .diagram-container img {
            max-width: 100%;
            height: auto;
            border-radius: 4px;
        }

        .states-summary {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
        }

        .state-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .state-initial { background: #fff2cc; color: #9a6700; border: 1px solid #d6b656; }
        .state-pending { background: #e1d5e7; color: #5c4a6e; border: 1px solid #9673a6; }
        .state-active { background: #d5e8d4; color: #2d6a2d; border: 1px solid #82b366; }
        .state-suspended { background: #ffe6cc; color: #8a5a00; border: 1px solid #d79b00; }
        .state-processing { background: #dae8fc; color: #3a5a8a; border: 1px solid #6c8ebf; }
        .state-terminal { background: #f8cecc; color: #8b2c2c; border: 1px solid #b85450; }

        .complexity-indicator {
            float: right;
            font-size: 12px;
            color: #666;
            background: var(--bg-light);
            padding: 4px 10px;
            border-radius: 4px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .info-box {
            background: var(--bg-light);
            border-radius: 8px;
            padding: 15px 20px;
            border-left: 4px solid var(--maxio-green);
        }

        .info-box h4 {
            margin: 0 0 10px 0;
            color: var(--maxio-green);
        }

        .info-box ul {
            margin: 0;
            padding-left: 20px;
        }

        .info-box li {
            margin: 5px 0;
            font-size: 14px;
        }

        footer {
            text-align: center;
            margin-top: 50px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
            color: #6c757d;
            font-size: 14px;
        }

        @media print {
            .diagram-section {
                page-break-inside: avoid;
            }
        }

        /* Navigation Bar */
        .nav-bar {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 12px 20px;
            background: #2c3e50;
            border-radius: 8px;
            margin-bottom: 30px;
        }

        .nav-bar a {
            color: #fff;
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            padding: 6px 12px;
            border-radius: 4px;
            transition: background 0.2s;
        }

        .nav-bar a:hover {
            background: rgba(255,255,255,0.15);
        }

        .nav-bar a.active {
            background: rgba(255,255,255,0.2);
        }

        .nav-home {
            display: flex;
            align-items: center;
            gap: 6px;
            padding-right: 20px;
            border-right: 1px solid rgba(255,255,255,0.3);
        }

        .nav-home svg {
            width: 18px;
            height: 18px;
            fill: currentColor;
        }

        .nav-dropdown {
            position: relative;
            padding: 6px 12px;
            border-radius: 4px;
            color: #fff;
            font-size: 14px;
            font-weight: 500;
        }

        .nav-dropdown:hover {
            background: rgba(255,255,255,0.15);
        }

        .nav-dropdown.active {
            background: rgba(255,255,255,0.2);
        }

        .nav-dropdown-toggle {
            display: flex;
            align-items: center;
            gap: 4px;
            cursor: pointer;
        }

        .nav-dropdown-toggle::after {
            content: "";
            border-left: 4px solid transparent;
            border-right: 4px solid transparent;
            border-top: 5px solid currentColor;
            margin-left: 2px;
        }

        .nav-dropdown-menu {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            background: #2c3e50;
            border-radius: 6px;
            padding: 8px 0;
            min-width: 160px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 100;
        }

        .nav-dropdown:hover .nav-dropdown-menu {
            display: block;
        }

        .nav-dropdown-menu a {
            display: block;
            padding: 8px 16px;
            border-radius: 0;
        }

        .nav-dropdown-menu a:hover {
            background: rgba(255,255,255,0.15);
        }

        .nav-dropdown-menu a.active {
            background: rgba(255,255,255,0.1);
        }
    </style>
</head>
<body>
    <nav class="nav-bar">
        <a href="../index.html" class="nav-home">
            <svg viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
            Home
        </a>
        <a href="../api-comparisons.html">API Comparisons</a>
        <div class="nav-dropdown">
            <span class="nav-dropdown-toggle">Zuora</span>
            <div class="nav-dropdown-menu">
                <a href="../zuora/order-to-cash-flow.html">OTC Flow</a>
                <a href="../zuora/entity-state-machines.html">State Machines</a>
            </div>
        </div>
        <div class="nav-dropdown">
            <span class="nav-dropdown-toggle">Stripe</span>
            <div class="nav-dropdown-menu">
                <a href="../stripe/entity-state-machines.html">State Machines</a>
            </div>
        </div>
        <div class="nav-dropdown active">
            <span class="nav-dropdown-toggle">Maxio</span>
            <div class="nav-dropdown-menu">
                <a href="entity-state-machines.html" class="active">State Machines</a>
            </div>
        </div>
    </nav>

    <h1>Maxio Entity State Machines</h1>
    <p class="subtitle">Lifecycle diagrams for core Maxio (Chargify) billing entities</p>

    <nav class="toc">
        <h3>Quick Navigation</h3>
        <ul>
            <li><a href="#subscription">Subscription</a></li>
            <li><a href="#invoice">Invoice</a></li>
            <li><a href="#components">Component Allocations</a></li>
        </ul>
    </nav>

    <!-- Subscription -->
    <section class="diagram-section" id="subscription">
        <h2>Subscription Lifecycle <span class="complexity-indicator">10 states</span></h2>
        <p class="description">
            Maxio Subscriptions have the most granular state model of the three platforms. The <code>soft_failure</code>
            state distinguishes initial payment failures from ongoing dunning (<code>past_due</code>). The <code>assessing</code>
            state represents system processing, while <code>on_hold</code> allows manual service suspension separate from
            payment-related states.
        </p>
        <div class="diagram-container">
            <img src="subscription-lifecycle.png" alt="Maxio Subscription Lifecycle State Machine">
        </div>
        <div class="states-summary">
            <span class="state-badge state-initial">trialing</span>
            <span class="state-badge state-processing">assessing</span>
            <span class="state-badge state-active">active</span>
            <span class="state-badge state-suspended">past_due</span>
            <span class="state-badge state-suspended">soft_failure</span>
            <span class="state-badge state-terminal">unpaid</span>
            <span class="state-badge state-suspended">on_hold</span>
            <span class="state-badge state-suspended">paused</span>
            <span class="state-badge state-terminal">canceled</span>
            <span class="state-badge state-terminal">expired</span>
        </div>
    </section>

    <!-- Invoice -->
    <section class="diagram-section" id="invoice">
        <h2>Invoice Lifecycle <span class="complexity-indicator">6 states</span></h2>
        <p class="description">
            Maxio Invoices support a <code>pending</code> state before issuance (similar to draft), and a <code>partial</code>
            state for invoices with partial payment applied. Multiple invoice types exist: Charge Invoice, Credit Note,
            Payment Invoice, Refund Invoice, and Ad Hoc Invoice.
        </p>
        <div class="diagram-container">
            <img src="invoice-lifecycle.png" alt="Maxio Invoice Lifecycle State Machine">
        </div>
        <div class="states-summary">
            <span class="state-badge state-initial">pending</span>
            <span class="state-badge state-processing">open</span>
            <span class="state-badge state-active">paid</span>
            <span class="state-badge state-suspended">partial</span>
            <span class="state-badge state-terminal">voided</span>
            <span class="state-badge state-terminal">canceled</span>
        </div>
    </section>

    <!-- Component Allocations -->
    <section class="diagram-section" id="components">
        <h2>Component Allocation Flow <span class="complexity-indicator">Process Flow</span></h2>
        <p class="description">
            Components are Maxio's mechanism for add-on pricing and usage-based billing. Products define
            available components, subscriptions allocate quantities, and the system handles proration
            according to configured policies. This is where Maxio's subscription modification model
            differs most from Stripe's inline updates and Zuora's formal amendments.
        </p>
        <div class="diagram-container">
            <img src="component-allocation-flow.png" alt="Maxio Component Allocation Flow">
        </div>

        <div class="info-grid">
            <div class="info-box">
                <h4>Component Types</h4>
                <ul>
                    <li><strong>Quantity-Based</strong> - Fixed quantity (e.g., seats, users)</li>
                    <li><strong>Metered</strong> - Usage reported and billed per period</li>
                    <li><strong>On/Off</strong> - Binary feature toggle</li>
                    <li><strong>Prepaid Usage</strong> - Pre-purchased usage credits</li>
                </ul>
            </div>
            <div class="info-box">
                <h4>Proration Policies</h4>
                <ul>
                    <li><strong>full</strong> - Charge/credit full period amount</li>
                    <li><strong>prorated</strong> - Charge/credit based on days remaining</li>
                    <li><strong>none</strong> - No immediate charge, apply at next renewal</li>
                </ul>
            </div>
            <div class="info-box">
                <h4>Allocation API</h4>
                <ul>
                    <li><code>POST /subscriptions/{id}/components/{cid}/allocations.json</code></li>
                    <li>Specify <code>quantity</code>, <code>memo</code></li>
                    <li>Set <code>upgrade_charge</code> and <code>downgrade_credit</code> policies</li>
                    <li>Optionally <code>prorate</code> and <code>accrue_charge</code></li>
                </ul>
            </div>
        </div>
    </section>

    <footer>
        <p>Maxio Entity State Machines - Sinch Payment Services</p>
        <p>Source: <a href="https://developers.maxio.com">Maxio Developer Documentation</a></p>
        <p>Last updated: December 2024</p>
    </footer>
</body>
</html>
